<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Firmenlauf 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
form { max-width: 600px; margin-bottom: 20px; }

input, select, button {
  padding: 10px;
  margin: 5px 0;
  width: 100%;
  box-sizing: border-box;
}

button {
  cursor: pointer;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
}
button:hover { background: #45a049; }

label { font-weight: bold; display: block; margin-top: 10px; }
small { display: block; color: #555; margin-bottom: 5px; }

.person-group { margin-bottom: 15px; }

.person-row {
  display: flex;
  gap: 8px;
}
.person-row select { flex: 1; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
}
th { background: #f0f0f0; }

.team-row {
  background: #e9f5e9;
  font-weight: bold;
}
.team-separator td {
  border-top: 3px solid #4CAF50;
}

.error { color: red; margin-top: 10px; }

#downloadBtn { display: none; margin-top: 10px; }

@media (max-width: 500px) {
  body { margin: 10px; }
}
</style>
</head>

<body>

<h2>üèÉ Firmenlauf Anmeldung</h2>

<form id="surveyForm">

  <!-- Person 1 -->
  <div class="person-group">
    <label>Person 1</label>
    <input id="p1" placeholder="Name" required>
    <div class="person-row">
      <select id="tshirt1">
        <option value="Nein">T-Shirt: Nein</option>
        <option value="Ja">T-Shirt: Ja</option>
      </select>
      <select id="size1">
        <option value="">Gr√∂√üe</option>
        <optgroup label="Frauen">
          <option value="Frauen S">S</option>
          <option value="Frauen M">M</option>
          <option value="Frauen L">L</option>
          <option value="Frauen XL">XL</option>
          <option value="Frauen 2XL">2XL</option>
        </optgroup>
        <optgroup label="M√§nner">
          <option value="M√§nner S">S</option>
          <option value="M√§nner M">M</option>
          <option value="M√§nner L">L</option>
          <option value="M√§nner XL">XL</option>
          <option value="M√§nner 2XL">2XL</option>
        </optgroup>
      </select>
    </div>
  </div>

  <!-- Person 2 -->
  <div class="person-group">
    <label>Person 2</label>
    <input id="p2" placeholder="Name">
    <div class="person-row">
      <select id="tshirt2">
        <option value="Nein">T-Shirt: Nein</option>
        <option value="Ja">T-Shirt: Ja</option>
      </select>
      <select id="size2">
        <option value="">Gr√∂√üe</option>
        <optgroup label="Frauen">
          <option value="Frauen S">S</option>
          <option value="Frauen M">M</option>
          <option value="Frauen L">L</option>
          <option value="Frauen XL">XL</option>
          <option value="Frauen 2XL">2XL</option>
        </optgroup>
        <optgroup label="M√§nner">
          <option value="M√§nner S">S</option>
          <option value="M√§nner M">M</option>
          <option value="M√§nner L">L</option>
          <option value="M√§nner XL">XL</option>
          <option value="M√§nner 2XL">2XL</option>
        </optgroup>
      </select>
    </div>
  </div>

  <!-- Person 3 -->
  <div class="person-group">
    <label>Person 3</label>
    <input id="p3" placeholder="Name">
    <div class="person-row">
      <select id="tshirt3">
        <option value="Nein">T-Shirt: Nein</option>
        <option value="Ja">T-Shirt: Ja</option>
      </select>
      <select id="size3">
        <option value="">Gr√∂√üe</option>
        <optgroup label="Frauen">
          <option value="Frauen S">S</option>
          <option value="Frauen M">M</option>
          <option value="Frauen L">L</option>
          <option value="Frauen XL">XL</option>
          <option value="Frauen 2XL">2XL</option>
        </optgroup>
        <optgroup label="M√§nner">
          <option value="M√§nner S">S</option>
          <option value="M√§nner M">M</option>
          <option value="M√§nner L">L</option>
          <option value="M√§nner XL">XL</option>
          <option value="M√§nner 2XL">2XL</option>
        </optgroup>
      </select>
    </div>
  </div>

  <label>Team</label>
  <input id="team" value="Zufall">
  <small>Bei ‚ÄûZufall‚Äú wird automatisch ein passendes Team gew√§hlt.</small>

  <button type="submit">Absenden</button>
</form>

<button id="downloadBtn">üì• Teams als Excel herunterladen</button>
<div id="error" class="error"></div>

<h2>üìã Teams</h2>
<table>
<thead>
<tr>
  <th>Team</th>
  <th>Name</th>
  <th>T-Shirt</th>
  <th>Gr√∂√üe</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, doc, getDocs, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app-check.js";

/* Firebase Config */
const firebaseConfig = {
  apiKey: "DEIN_API_KEY",
  authDomain: "firmenlauf-8e694.firebaseapp.com",
  projectId: "firmenlauf-8e694",
  storageBucket: "firmenlauf-8e694.firebasestorage.app",
  messagingSenderId: "740730808511",
  appId: "1:740730808511:web:11a5d055eb10790a453e0a"
};

const app = initializeApp(firebaseConfig);
initializeAppCheck(app, {
  provider: new ReCaptchaV3Provider("DEIN_RECAPTCHA_KEY"),
  isTokenAutoRefreshEnabled: true
});

const db = getFirestore(app);
const teamsRef = collection(db, "teams");

const nameA = ["Byte","CPU","RAM","Pixel","Code","Server","GPU","Kernel"];
const nameB = ["Runner","Sprint","Dash","Speed","Marathon","Track"];
const randomTeamName = () =>
  `${nameA[Math.floor(Math.random()*nameA.length)]} ${nameB[Math.floor(Math.random()*nameB.length)]} ${Math.floor(Math.random()*1000)}`;

async function getAllTeams() {
  const snap = await getDocs(teamsRef);
  const teams = {};
  snap.forEach(d => teams[d.id] = d.data().members);
  return teams;
}

/* Tabelle */
onSnapshot(teamsRef, snap => {
  tableBody.innerHTML = "";
  snap.forEach(d => {
    const head = document.createElement("tr");
    head.className = "team-row team-separator";
    head.innerHTML = `<td colspan="4">üèÅ ${d.id}</td>`;
    tableBody.appendChild(head);

    d.data().members.forEach(m => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td></td>
        <td>${m.name}</td>
        <td>${m.tshirt}</td>
        <td>${m.size || "-"}</td>
      `;
      tableBody.appendChild(tr);
    });
  });
});
</script>

</body>
</html>
